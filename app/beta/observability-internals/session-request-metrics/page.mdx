# Session & Request Analytics

Session and request analytics provide activity-level visibility into application usage.

They are built on raw metrics events.

There is no explicit session lifecycle model.

Sessions are inferred from activity.

---

## Session Model

Sessions are identified by:

- `session_id`

The `session_id` is generated client-side and included in metrics events.

Characteristics:

- Persistent during active usage
- Shared across navigation and request events
- Used as aggregation key

There is no explicit:

- `session_start` event
- `session_end` event
- Heartbeat mechanism

Session boundaries are inferred.

---

## Session Boundary Inference

Session duration is derived from:

- First event timestamp
- Last event timestamp

A session is considered active while events are being received.

There is no server-driven idle timeout for metrics sessions.

Session analytics are activity-based, not state-machine-based.

---

## Request Metrics

Request metrics capture:

- HTTP method
- Path
- Status code
- Latency
- Session context
- Application scope

They are:

- Captured in SDK
- Sent via `POST /metrics`
- Stored as raw events
- Aggregated dynamically via Mongo pipelines

Request metrics are not directly tied to user identity.

They are scoped by:

- `application`
- `session_id`

---

## Navigation Metrics

Navigation metrics track:

- Client-side route changes
- SPA transitions
- pushState/popstate events

Navigation metrics:

- Are SPA-aware (basic)
- Include `session_id`
- Do not include referrer
- Do not include page duration

Navigation analytics are event-driven.

There is no built-in dwell time computation.

---

## Aggregation Model

Dashboards compute:

- Session counts
- Request counts
- Error rates
- Route distribution
- Activity trends

All aggregations are:

- On-demand
- Executed via Mongo aggregation pipelines
- Not pre-aggregated
- Not cached

This provides flexibility at the cost of horizontal scalability.

---

## Identity Boundary

Metrics:

- Do not include user identifiers by default
- Are not identity-scoped
- Operate at application boundary

This design separates:

- Governance-grade logs (audit)
- Analytics-grade metrics

User-specific analytics are intentionally limited.

---

## Disabled Users

If a user identity is disabled:

- Metrics ingestion may still occur at application level.
- Metrics are not blocked by user state.

Observability operates independently of user enforcement logic.

---

## Limitations

Current session analytics do not provide:

- Deterministic session termination
- Heartbeat-based inactivity detection
- Per-user session analytics
- Cross-session stitching
- Navigation duration metrics

Session insights are derived solely from recorded activity.

---

## Architectural Philosophy

Session & request analytics favor:

- Simplicity
- Deterministic ingestion
- Logical grouping by session_id
- On-demand aggregation

They avoid:

- Complex session state machines
- Real-time streaming systems
- High-frequency background jobs

This is aligned with Beta architecture goals.

---

## Next Step

To understand how observability data is stored and queried, continue with:

- Storage & Query Model
