# Identity Internals

Identity Internals describes how AuditAuth implements authentication, session management, token issuance, and enforcement at a structural level.

This section is architect-focused.

It explains:

- Token lifecycle
- Session persistence
- Refresh rotation
- Revocation mechanics
- MFA validation boundaries
- Trust separation
- Key management model
- Security trade-offs

This is not marketing documentation.

It reflects the current implementation of AuditAuth (Beta).

---

## Beta Notice

AuditAuth is currently in Beta.

The identity core is production-capable, but certain enterprise features are intentionally minimal in this phase.

Specifically:

- No JWKS endpoint (single public key exposure)
- No multi-key rotation support
- No token introspection endpoint
- No absolute session lifetime limit
- No distributed blacklist system

These constraints are deliberate.

The current design prioritizes:

- Deterministic behavior
- Minimal state
- Predictable enforcement
- Clear trust boundaries

Future stable releases will include:

- JWKS endpoint support
- Key rotation with multiple active keys
- Expanded token lifecycle controls
- Enhanced session governance policies

---

## Design Philosophy

AuditAuth follows a minimal-state identity model.

Principles:

- Short-lived access tokens
- Opaque refresh tokens
- Session-bound revocation
- No global token blacklist
- No runtime introspection dependency

Enforcement decisions are:

- Application-scoped
- Session-aware
- Plan-driven
- Lifecycle-aware

The system avoids hidden global state.

---

## Architectural Boundary

Authentication and identity enforcement are separate concerns.

Authentication validates user identity.

Enforcement validates application eligibility and permissions.

Identity validity does not automatically imply operational eligibility.

Application lifecycle state may restrict system access independently.

---

## Token Model (High-Level)

Access tokens:

- JWT
- Signed with RS256
- 30-minute TTL
- Application-scoped
- Include identity and account claims

Refresh tokens:

- Opaque random values
- Stored hashed in database
- Rotated on every refresh
- Bound to a session record
- ~5-day sliding expiration

Access tokens are stateless.

Refresh tokens are state-bound.

---

## Revocation Model (High-Level)

AuditAuth does not use token blacklists.

Revocation occurs via:

- Session invalidation
- Refresh token invalidation
- Natural expiration

Access tokens remain valid until expiration.

Refresh control governs long-term session continuity.

This model reduces runtime overhead and avoids distributed state complexity.

---

## MFA Boundary

Multi-Factor Authentication (MFA):

- Uses TOTP
- Enforced per plan
- Enforced per user
- Validated before token issuance

Tokens are not issued until MFA requirements are satisfied.

MFA is not a post-token step.

---

## Trust Model

AuditAuth separates:

- Authentication domain
- Application domain

Refresh tokens (browser flow):

- Stored in httpOnly cookies
- Secure flag enabled in production
- SameSite configured appropriately per environment

Access tokens are transmitted via Authorization header.

---

## What This Section Covers

The following pages provide deep technical detail:

- Token Lifecycle
- Session Model
- Refresh & Sliding Expiration
- Revocation Model
- MFA Architecture
- Trust Boundaries
- Key Management
- Security Trade-offs

These pages describe the exact behavior of the current Beta implementation.

---

## Intended Audience

This section is intended for:

- Senior developers
- System architects
- Security reviewers
- CTO-level decision makers

It assumes familiarity with:

- JWT
- OAuth-style token flows
- Session-based identity systems
- Web security fundamentals

Proceed to:

- Token Lifecycle
